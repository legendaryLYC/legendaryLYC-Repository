<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="_meta :: header"/>
<head>
    <link data-n-head="true" rel="icon" type="image/x-icon" th:href="@{/favicon.ico.css}"href="favicon.ico.css" />
    <script data-n-head="true" th:src="@{/font/js/jquery.min.js}"src="font/js/jquery.min.js"></script>
    <script data-n-head="true" th:src="@{/font/js/index.js}"src="js/index.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/font/css/information.css}"href="font/css/information.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/font/css/el.css}"href="font/css/el.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/font/css/project.css}" href="css/project.css"/>
</head>
<body>
<div id="__nuxt">
    <div class="nuxt-progress" style="width:0%;height:2px;background-color:#3B8070;opacity:0;"></div>
    <div id="__layout">
        <div>
            <div>
                <!-- 公共顶部header -->
                <header th:include="front/common/_header :: header" class="header" data-v-8e52717c></header>
                <!-- 公共导航 -->
                <nav th:include="front/common/_nav :: nav" class="nav_index" data-v-bdccf15a></nav>
                <div class="membar" data-v-24a6dbce="" th:include="front/center/_nav :: nav">
                    <ul data-v-24a6dbce="">
                        <li data-v-24a6dbce=""> <a href="project.htm" data-v-24a6dbce=""> 我的项目 </a> </li>
                        <li class="check" data-v-24a6dbce=""> <a href="information.htm" data-v-24a6dbce=""> 个人信息 </a> </li>
                        <li data-v-24a6dbce=""> <a href="auth.htm" data-v-24a6dbce=""> 实名认证 </a> </li>
                        <li data-v-24a6dbce=""> <a href="wallet.htm" data-v-24a6dbce=""> 我的账户 </a> </li>
                        <li data-v-24a6dbce=""> <a href="myNew.htm" data-v-24a6dbce=""> 我的消息 </a> </li>
                    </ul>
                </div>
                <div id="MyPersonalBasicNews" >
                    <div class="container" style="padding-left: 0px;padding-right: 0px;">
                        <h2>修改项目</h2>
                        <!-- 修改基本信息 -->

                        <div class="changeBasic" style="padding-bottom:40px;border:0;">

                                <div class="containerBox" data-v-d0b3a19c>
                                    <form class=" el-form demo-ruleForm " id="form" enctype="multipart/form-data"  style="width: 100%;" th:action="@{/center/frontstage/editstagecheck}" method="post">
                                        <input type="hidden" name="phaseauditid" th:value="${projectPhaseAudit.getId()}">
                                        <input type="hidden" name="stageCode" th:value="${projectPhaseAudit.getStageCode()}">
                                        <input type="hidden" name="projectid" th:value="${projectPhaseAudit.getProjectId()}">
                                    <div class="headerPic">
                                        <div class="el-form-item">
                                            <div class="el-form-item__content" style="margin-left: 125px;">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="content" style="width: 100%;">



                                        <div class="NameAndEmail clearfix">
                                            <div class="Name">
                                                <div class="el-form-item">
                                                    <label for="name" class="el-form-item__label" style="width: 125px;">已上传文件：</label>
                                                    <div class="el-form-item__content" style="margin-left: 125px;">
                                                        <div class="changeWidth el-input">
                                                            <input type="text" th:if="${#lists.isEmpty(phaseAuditFilesList)}" autocomplete="off" class="el-input__inner" value="未上传任何文件"/>
                                                            <div th:each="url:${phaseAuditFilesList}">
                                                                <input type="text" autocomplete="off" class="el-input__inner" th:value="${url.getFileName()}" />
                                                                <button type="button" class="el-button el-button--danger el-button--mini"  th:onclick="'javascript:del('+${url.getId()}+');'" style="margin-left:30px;" data-v-d0b3a19c="">
                                                                    <span>删除</span></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="NameAndEmail clearfix">
                                            <div class="Name">
                                                <div class="el-form-item">
                                                    <label for="name" class="el-form-item__label" style="width: 125px;">上传新文件：</label>
                                                    <div class="el-form-item__content" style="margin-left: 125px;">
                                                        <div class="changeWidth el-input">
                                                            <input type="text" autocomplete="off" id="path" class="el-input__inner" />
                                                            <a href="javascript:void();" class="btn btn-primary upload-btn" style="line-height: 32px;"><i class="Hui-iconfont"></i> 浏览文件</a>
                                                            <input type="file" multiple="multiple" name="files" id="files" class="input-file valid" style="height: 100%;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>



                                    </div>
                                    <div style="float: left;">
                                        <input type="submit" class="el-button el-button--primary el-button--mini"  style="margin-left:150px;" data-v-d0b3a19c="" value="重新提交阶段验收申请">
                                    </div>
                            </form>

                                        <button onclick="javascript:history.back(-1)" class="el-button el-button--cancle el-button--mini"  style="margin-left:60px;" data-v-d0b3a19c="">取消</button>

                                </div>

                        </div>

                    </div>
                </div>
            </div>
            <!-- 公共底部 -->
            <div th:include="front/common/_footer :: footer" id="footer" data-v-407369c6 data-v-2a183b29></div>
        </div>
    </div>
</div>
</div>
</body>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/jquery.validate.js}" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<!-- <script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/validate-methods.js}" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>  -->
<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/messages_zh.js}"  src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" th:src="@{/lib/My97DatePicker/4.8/WdatePicker.js}"  src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" th:src="@{/lib/select/fSelect.js}" src="lib/select/fSelect.js"></script>
<script type="text/javascript" th:src="@{/lib/layer/2.4/layer.js}" src="lib/layer/2.4/layer.js"></script>
<script data-n-head="true" th:src="@{/js/common/layer.js}" src="js/common/layer.js"></script>
<script>


    function fun(){
        var val = document.getElementById("designerType").value.split(",");
        var boxes = document.getElementsByName("designerTypes");
        for(i=0;i<boxes.length;i++){
            for(j=0;j<val.length;j++){
                if(boxes[i].value == val[j]){
                    boxes[i].checked = true;
                }
            }
        }
    }



    function del(id){
        $.ajax({
            type: 'post',
            url: "/center/frontstage/deleteFile" ,
            data:{"id":id},
            success: function(data){
                if(data == "success"){
                    layer.designMsg('删除成功!',1,function(){
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.location.reload();
                        parent.layer.close(index);
                    });
                }else{
                    layer.msg('删除失败!',{icon:1,time:1000});
                }
            },
            error: function(XmlHttpRequest, textStatus, errorThrown){
                layer.msg('删除失败!请检查网络连接！',{icon:1,time:1000});
            }
        });
    }

    //  $(function () {
    //      $("#submit").click(function () {
    //     	 var form = new FormData(document.getElementById("form"));
    //          $.ajax({
    //              url: "/center/myProject/updateProject",
    //              type: "POST",
    //              data: formData,
    //              /**
    //              *必须false才会自动加上正确的Content-Type
    //              */
    //              contentType: false,
    //              /**
    //              * 必须false才会避开jQuery对 formdata 的默认处理
    //              * XMLHttpRequest会对 formdata 进行正确的处理
    //              */
    //              processData: false,
    //              success: function (data) {
    //                  if (data == "success") {
    //                      alert("上传成功！");
    //                  }
    //                  if (data == "fail") {
    //                      alert("修改失败");
    //                  }
    //              },
    //              error: function () {
    //                  alert("上传失败！");
    //              }
    //          });
    //      });
    //  });



    $(function() {
        $('.demo').fSelect();
        fun();
    });

    var result;
    //选择省份事件
    $("#province").change(function() {
        //先清空城市和区
        $("#city").empty();
        $("#areaId").empty();
        $('#city').append("<option value=''>待选择</option>");
        $('#areaId').append("<option value=''>待选择</option>");
        if($("#province").val()==""){
            //啥都不做
        }else{
            chooseDic("province",$("#province").val());
            var flag = false;
            for (i in result){
                $('#city').append("<option value='"+result[i].cityId+"'>"+result[i].name+"</option>");
            }
        }
    });
    //选择城市事件
    $("#city").change(function() {
        //先清空规格
        $("#areaId").empty();
        $('#areaId').append("<option value=''>待选择</option>");
        if($("#city").val()==""){
            //啥都不做
        }else{
            chooseDic("city",$("#city").val());
            for (i in result){
                $('#areaId').append("<option value='"+result[i].areaId+"'>"+result[i].name+"</option>");
            }
        }
    });
    //选择下拉菜单时和后台要字典的交互方法
    function chooseDic(who,code){
        var toServer={
            who : who,
            code : code,
        }
        //此处请求后台程序，下方是成功后的前台处理……
        $.ajax({
            type: 'POST',
            url: "/center/myProject/getareadic",
            dataType: 'json',
            data:toServer,
            async:false,
            success: function(data){
                //返回服务器返回的字典对象
                result = data;

            },
            error:function(data) {
                console.log("错误!");
            },
        });
    }

    //加载时请求回显省市区
    $(function(){
        $('#province').val($('#provinceRecord').val());
        $('#allowView').val($('#allowViewValue').val());
        chooseDic("province",$("#province").val());
        for (i in result){
            $('#city').append("<option value='"+result[i].cityId+"'>"+result[i].name+"</option>");
            $('#city').val($('#cityRecord').val());
        }
        chooseDic("city",$("#city").val());
        for (i in result){
            $('#areaId').append("<option value='"+result[i].areaId+"'>"+result[i].name+"</option>");
            $('#areaId').val($('#areaRecord').val());
        }
    });
    // (function ($) {
    //     $.extend($.validator.messages, {
    //         required: "",
    //     });
    // }(jQuery));

    $("#form").validate({
        rules:{
            name:{
                required:true,
                minlength:4,
                maxlength:16
            },
            typeCode:{
                required:true,
            },
            province:{
                required:true,
            },
            city:{
                required:true,
            },
            areaId:{
                required:true,
            },
            modelCode:{
                required:true,
            },
            startupDate:{
                required:true,
            },
            deadline:{
                required:true,
            },
            registrationDeadline:{
                required:true,
            },
            constructionBudget:{
                required:true,
            },
            designerTypes:{
                required:true,
            },
            allowView:{
                required:true,
            },
            designBudget:{
                required:true,
            },
            introduce:{
                required:true,
            },
        },
        onkeyup:false,
        success:"valid",
    });

    var file = $('#files'),
        aim = $('#path');
    file.on('change', function( e ){
        var i;
        //e.currentTarget.files 是一个数组，如果支持多个文件，则需要遍历
        for (i = 0;i < e.currentTarget.files.length; i++){
            var name = e.currentTarget.files[i].name;
            if($.trim(aim.val()) == ''){
                aim.val( aim.val()+name );
            }
            else if($.trim(aim.val()) != ''){
                aim.val( aim.val()+","+name );
            }
        }
    });

</script>
</html>
