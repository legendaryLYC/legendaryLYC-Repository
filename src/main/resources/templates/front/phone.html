<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="front/common/_meta :: header"/>
 <head>
  <link data-n-head="true" rel="icon" type="image/x-icon" th:href="@{/font/favicon.ico.css}" href="favicon.ico.css" />
  <script data-n-head="true" th:src="@{/font/js/jquery.min.js}" src="js/jquery.min.js"></script>
  <script data-n-head="true" th:src="@{/font/js/index.js}" src="js/index.js"></script>
  <link rel="stylesheet" type="text/css" th:href="@{/font/css/el.css}" href="css/el.css">
 <link rel="stylesheet" type="text/css" th:href="@{/font/css/forgotpwd.css}" href="css/forgotpwd.css">
</head>
<body data-n-head="">
<div data-server-rendered="true" id="__nuxt">
 <div class="nuxt-progress" style="width:0%;height:2px;background-color:#3B8070;opacity:0;"></div>
 <div id="__layout">
  <div>
   <div data-v-802e0a44>
    <!-- 公共顶部header -->
    <header th:include="front/common/_header :: header" class="header" data-v-8e52717c></header>
    <!-- 公共导航 -->
    <nav th:include="front/common/_nav :: nav" class="nav_index" data-v-bdccf15a></nav>

    <div class="asider" data-v-802e0a44>
     <ul></ul>
    </div>
      <div class="register" data-v-c89a40f6="" style="height:500px;">
       <div class="container" data-v-c89a40f6="">
        <div class="register_box" data-v-c89a40f6="" style="height:500px;">
         <div class="skewing" data-v-c89a40f6="">
          <h4 data-v-c89a40f6="">重置您的密码</h4>
          <form class="el-form" data-v-c89a40f6="" action="#" th:action="@{/resetPWD/updataTel}"  method="post">
          <center>
          	<span class="r"><strong th:text="${flag}" style = "font-size:13px;color:red;"></span>
            <span class="r"><strong th:text="${flag1}" style = "font-size:13px;color:red;"></span>
          </center>
           <div class="el-form-item is-required" data-v-c89a40f6="">
            <label for="account" class="el-form-item__label" style="width:100px;">手机号码</label>
            <div class="el-form-item__content" style="margin-left:100px;">
             <div class="el-input" data-v-c89a40f6="">
              <input autocomplete="off" type="account" rows="2" name="tel" validateevent="true" class="el-input__inner" />
             </div>
            </div>
           </div>
           <div class="el-form-item is-required" style="width:550px;" data-v-f11a6d84="">
            <label for="messageNumber" class="el-form-item__label" style="width:100px;">短信验证码</label>
            <div class="el-form-item__content" style="margin-left:100px;">
             <div class="el-input" style="width:281px;" data-v-f11a6d84="">
             
              <input autocomplete="off" type="messageNumber" name="telCode" rows="2" validateevent="true" value="" class="el-input__inner" />
           
             </div>
             <button type="button" id="button" class="el-button el-button--danger" style="margin-left:2px;" data-v-f11a6d84="">
              <span>获取验证码</span></button>
            </div>
           </div>
           <div pattern="^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,8}$" minlength="8" class="el-form-item is-required" data-v-c89a40f6="">
            <label for="passwd" class="el-form-item__label" style="width:100px;">密码</label>
            <div class="el-form-item__content" style="margin-left:100px;">
             <div class="el-input" data-v-c89a40f6="">
              <input autocomplete="off" type="password" rows="2" name="password" validateevent="true" value="" class="el-input__inner" />
             </div>
            </div>
           </div>
           <div class="el-form-item is-required" data-v-c89a40f6="">
            <label for="passwdCheck" class="el-form-item__label" style="width:100px;">确认密码</label>
            <div class="el-form-item__content" style="margin-left:100px;">
             <div class="el-input" data-v-c89a40f6="">
              <input autocomplete="off" type="password" rows="2" name="password2" validateevent="true" value="" class="el-input__inner" />
             </div>
            </div>
           </div>
           <div class="el-form-item" data-v-c89a40f6="">
            <div class="el-form-item__content" style="margin-left:100px;">
             <button type="submit" id="sub_btn" long=""  class="el-button loginBtn el-button--primary" data-v-c89a40f6="">
              <span>重置密码</span></button>
            </div>
           </div>
          </form>
         </div>
         <div class="goLogin" data-v-c89a40f6="">
          已有账号 
          <a th:href="@{/login}" data-v-c89a40f6=""><span data-v-c89a40f6="">前往登录</span></a>
         </div>
        </div>
       </div>
      </div>
     <!-- 公共底部 -->
     <div th:include="front/common/_footer :: footer" id="footer" data-v-407369c6 data-v-2a183b29></div>
    </div>
   </div>
  </div>
 </div>

<!--_footer 作为公共模版分离出去-->
<div th:replace="_footer :: footerjs"></div>
<!--/_footer 作为公共模版分离出去-->
<script type="text/javascript" th:src="@{/lib/layer/2.4/layer.js}" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript">
	$(function(){
		//1、查找注册按钮绑定单击事件
		$("#sub_btn").click(function(){
			//2、点击时 获取用户注册信息逐个验证
			var $tel = $("[name='tel']").val();
			 var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;  
		    if(!myreg.test($tel)){ 
		    	layer.msg('手机号有误，请重新填写',{icon:1,time:1000},function(){	
				});
		        return false; 
		    } 
			var $password = $("[name='password']").val();
			//创建验证密码的正则对象
			var pwdReg = /^[a-z0-9_-]{6,18}$/;
			if(!pwdReg.test($password)){
				layer.msg('请输入一个包含小写字母a-z,数字0-9,_,-的六位以上的密码',{icon:1,time:1000},function(){	
				});
				return false;
			};
			var $repwd = $("[name='password2']").val();
			//直接和$password比较是否一致，如果一致可以提交，不一致取消提交
			if($repwd != $password){
				layer.msg('两次密码输入不一致！',{icon:1,time:1000},function(){	
				});
				return false;
			}

		});
	});
	$(function(){
		 $("#button").on("click",function(){
			 
			 var tel = $("[name='tel']").val();
			 
				//创建邮箱正则对象
				var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;    
				if(!myreg.test(tel)){ 
					layer.msg('手机号有误，请重新填写',{icon:1,time:1000},function(){	
					});
// 			        alert("手机号码有误，请重填");  
			        return false; 
			    } 
				 
			 var data1 ={
						 'tel':tel,
			 };
			 $.ajax({  
		   	     url:"/resetPWD/obtainTelCode",// 跳转到 action  
		   	     data:{
		   	    	'tel':tel,
						 },  
		   	     type:'post',  
		   	     success:function(data) {  
		   	         if(data.code == "1"){  
		   	        	timeKeep();
		   	        	layer.msg('发送成功,请稍后!',{icon:1,time:1000},function(){	
						});
//		   	        	window.location.href = "/myAccount/inwallet"; 
		   	         }else{  
		   	        	layer.msg('获取验证码失败',{icon:1,time:1000},function(){	
						});
		   	         }  
		   	      } 
		        });
		 });
	 }); 
	
	function timeKeep() {

		  var thisEle = $("#button").css("font-size");
		//parseFloat的第二个参数表示转化的进制，10就表示转为10进制
		  var textFontSize = parseFloat(thisEle , 10);
		//javascript自带方法
	      var unit = thisEle.slice(-2); //获取单位
	      var textFontSize = textFontSize-6 ;
			    let count = 60;
			    const countDown = setInterval(() => {
			      if (count === 0) {
			    	  textFontSize = textFontSize+7 ;
				   $('#button').css(
						        'font-size', textFontSize + unit
						       );
			       $('#button').text('重新发送').removeAttr('disabled');
			       $('#button').css({
			        background: '#ff9400',
			        color: '#fff',
			       });
			       clearInterval(countDown);
			      } else {
			       $('#button').attr('disabled', true);
			       $('#button').css({
			        background: '#d8d8d8',
			        color: '#707070',
			       });
			       $('#button').css(
				        'font-size', textFontSize + unit
				       );
			       $('#button').text(count + '秒后可重新获取');
			      }
			      count--;
			     }, 1000);
			    };
	 
</script>