<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="_meta :: header"/>
<head>
    <meta data-n-head="true" charset="utf-8"/>
    <meta data-n-head="true" name="viewport" content="width=device-width, initial-scale=1"/>
    <meta data-n-head="true" data-hid="keywords" name="keywords" content="方案设计、设计业务、建筑设计、互联网设计院、建筑众包"/>
    <meta data-n-head="true" data-hid="description" name="description" content="建筑众包拥有国内外顶尖的建筑设计、互联网、云计算和大数据等资源，为开发商、设计师、设计公司，建材供应、施工、项目管理等建筑产业各环节的用户，提供优质的合作共赢平台。"/>
    <title data-n-head="true">建筑众包--人工智能互联网设计院</title>
    <link data-n-head="true" rel="icon" type="image/x-icon" th:href="@{/favicon.ico.css}"href="favicon.ico.css" />
    <script data-n-head="true" th:src="@{/font/js/jquery.min.js}"src="font/js/jquery.min.js"></script>
    <script data-n-head="true" th:src="@{/font/js/index.js}"src="js/index.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/font/css/index.css}" href="font/css/index.css"/>
	<link rel="stylesheet" type="text/css" th:href="@{/font/css/information.css}"href="font/css/information.css"/>
	<link rel="stylesheet" type="text/css" th:href="@{/font/css/el.css}"href="font/css/el.css"/>
	<link rel="stylesheet" type="text/css" th:href="@{/font/css/project.css}" href="css/project.css"/>
	<style>
		label.error {
			position: unset;
			right: 18px;
			top: 5px;
			color: #ef392b;
			font-size: 12px;
		}
		.el-input__inner{
			width: 320px;
		}
		.btn.btn-primary.upload-btn{
			width: 152px;
		    height: 40px;
		    text-align: center;
		    font-size: 16px;
		    border-radius: 4px;
		    cursor: pointer;
		    display: inline-block;
		}
		.el-input__inner{
			width: 270px;
		}
		.el-input__suffix{
			right: 55px;
		}
		.el-form-item__content .el-input__suffix{
			right: 5px;
		}
		.el-form-item__content{
			line-height: 20px;
		}
	</style>
</head>
<body>
       <div class="container" style="padding-left: 0px;padding-right: 0px;"> 
		<div class="changeBasic" style="padding-bottom:40px;border:0;">
		   <form class=" el-form demo-ruleForm " id="form" enctype="multipart/form-data"  style="width: 100%;" th:action="@{/center/myProject/updateProject}" method="post">
			<div class="containerBox" data-v-d0b3a19c>
			 <div class="headerPic">
			  <div class="el-form-item">
			   <div class="el-form-item__content" style="margin-left: 125px;">
			   </div>
			  </div>
			 </div>
			 
			 <div class="content" style="width: 100%;">
			  
			 
			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">项目名称：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" autocomplete="off" class="el-input__inner" name="name" th:value="${project.name}" placeholder="请输入项目名称"/>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
			  
			  
			  <div class="Name">
				<div class="el-form-item is-required">
				 <label for="email" class="el-form-item__label" style="width: 125px;">项目类型：</label>
				   <div class="el-col el-col-6" style="width: 320px;">
					  <div class="el-input el-input--suffix">
						  <select name="typeCode"class=" el-input__inner">
							<option value="" disabled selected style='display:none;'>请选择类型</option>
							<option th:each="type:${types}" th:selected="${project.typeCode eq type.code}" th:text="${type.description}" th:value="${type.code}">空</option> 
							</select>
						  	<span class="el-input__suffix">
								<span class="el-input__suffix-inner">
									<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
								</span>
						  	</span> 
					  </div>
					</div>
				</div>
			  </div>

                 <div class="NameAndEmail clearfix">
                     <div class="Name">
                         <div class="el-form-item is-required">
                             <label for="name" class="el-form-item__label" style="width: 125px;">设计要求：</label>
                             <div class="el-form-item__content" style="margin-left: 125px;">
                                 <div class="changeWidth el-input">
                                     <textarea type="text" autocomplete="off" style="height:150px;" class="el-input__inner" id="" name="requirements" placeholder="请输入项目的方案要求" th:text="${project.requirements}"></textarea>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
			  
			  <div class="Name">
				<div class="el-form-item is-required">
				 <label for="email" class="el-form-item__label" style="width: 125px;">设计师类别：</label>
				 	<input type="hidden" id="designerType" th:value="${project.componentCode}"/>
				   <div class="el-col el-col-6" style="width: 320px;">
					  <div class="el-input el-input--suffix">
						 <input type="checkbox"  name="designerTypes" value="" th:each="type : ${designerType}"
						 th:value="${type.code}" th:text="${type.description}+'   '"></input>
					  </div>
					</div>
				</div>
			  </div>
			  
			  
			  <div class="Name">
				<div class="el-form-item is-required">
				 <label for="email" class="el-form-item__label" style="width: 125px;">文件展示方式：</label>
				 <input type="hidden" id="allowViewValue" th:value="${project.allowView}"/>
				 <div class="el-col el-col-6" style="width: 320px;">
					 <div class="el-input el-input--suffix">
						 <select name="allowView" id="allowView" class=" el-input__inner">
								<option value="" disabled selected style='display:none;'>请选择方式</option>
								<option value="1">允许所有人查看</option>
								<option value="0">只允许选中设计师查看</option>
						  </select>
						  <span class="el-input__suffix">
								<span class="el-input__suffix-inner">
									<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
								</span>
						  </span> 
					 </div>
				 </div>
				</div>
			  </div>
			  
			  
			  <input type="hidden" name="id" th:value="${project.id}"/>
			  
			  <div class="el-form-item is-required">
			   <label for="province" class="el-form-item__label" style="width: 125px;">所在地：</label>
			   <div class="el-form-item__content" style="margin-left: 125px;">
				<div class="el-row">
				 <div class="el-col el-col-6">
				  <div class="el-input el-input--suffix">
				  	  <input type="hidden" id="pId" th:value="${project.provinceId}" />
					  <input type="hidden" id="cId" th:value="${project.cityId}" />
					  <input type="hidden" id="aId" th:value="${project.areaId}" />
					  <select id="provinceId" name="provinceId" class=" el-input__inner" >
						<option value="" disabled selected style='display:none;'>请选择省</option>
						<option th:each="pro:${province}" th:text="${pro.getName()}" th:value="${pro.getProvinceId()}" >空</option> 
					  </select>
					  <span class="el-input__suffix">
						<span class="el-input__suffix-inner">
							<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
						</span>
					  </span> 
				  </div>
				 </div>
				 <div class="el-col el-col-6" id="cityDiv">
				   <div class="el-input el-input--suffix" style="margin-left:10px;">
					  <select class=" el-input__inner" id="cityId" name="cityId">
					  	
						<option value='' style='display:none;'>请选择市</option>
					  </select> 
					<span id="cityRecord" style="display:none"></span>
					  <span class="el-input__suffix">
						<span class="el-input__suffix-inner">
							<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
						</span>
					  </span> 
				  </div>
				 </div>
				 <div class="el-col el-col-6" id="areaDiv">
				  <div class="el-input el-input--suffix" style="margin-left:20px;">
					  <select class=" el-input__inner" id="areaId" name="areaId">
						<option value='' disabled selected style='display:none;'>请选择县</option>
					  </select> 
					<span id="areaRecord" style="display:none"></span>
					  <span class="el-input__suffix">
						<span class="el-input__suffix-inner">
							<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
						</span>
					  </span> 
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
			  <div class="Name">
					<div class="el-form-item is-required">
					 <label for="email" class="el-form-item__label" style="width: 125px;">项目规模：</label>
					   <div class="el-col el-col-6" style="width: 320px;">
						  <div class="el-input el-input--suffix">
							  <select name="modelCode" class=" el-input__inner">
								<option th:each="model:${models}" th:selected="${project.modelCode eq model.code}" th:text="${model.description}" th:value="${model.code}">空</option>
								</select>
							  	<span class="el-input__suffix">
									<span class="el-input__suffix-inner">
										<i class="el-select__caret el-input__icon el-icon-arrow-down"></i>
									</span>
							  	</span> 
						  </div>
						</div>
					</div>
			   </div>
			   
			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">预计启动日期：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" class="el-input__inner Wdate" onfocus="WdatePicker({el:$dp.$('startupDate'),dateFmt:'yyyy-MM-dd'})" readonly="readonly"
				   th:value="${#dates.format(project.startupDate, 'yyyy-MM-dd')}" 
				   autocomplete="off" value="" name="startupDate" placeholder="请选择预计启动日期"/>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
			  
			  
			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">预计截止日期：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" class="el-input__inner Wdate" onfocus="WdatePicker({el:$dp.$('startupDate'),dateFmt:'yyyy-MM-dd'})" readonly="readonly"
				   	 th:value="${#dates.format(project.deadline, 'yyyy-MM-dd')}" 
				   autocomplete="off" value="" name="deadline" placeholder="请选择预计截止日期"/>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
			  
			  
			  
			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">报名截止日期：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" class="el-input__inner Wdate" onfocus="WdatePicker({el:$dp.$('startupDate'),dateFmt:'yyyy-MM-dd'})" readonly="readonly"
				  	th:value="${#dates.format(project.registrationDeadline, 'yyyy-MM-dd HH:mm:ss')}" 
				   autocomplete="off" value="" name="registrationDeadline" placeholder="请选择报名截止日期"/>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>


				 <div class="NameAndEmail clearfix">
					 <div class="Name">
						 <div class="el-form-item is-required">
							 <label for="name" class="el-form-item__label" style="width: 125px;">总工程费用：</label>
							 <div class="el-form-item__content" style="margin-left: 125px;">
								 <div class="changeWidth el-input">
									 <input type="text" autocomplete="off" class="el-input__inner"  id="allBudget" th:value="${project.constructionBudget}" name="constructionBudget" placeholder="请输入总工程费用"/>
								 	 <span class="yuan_after">元</span>
								 </div>
							 </div>
						 </div>
					 </div>
				 </div>



			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">设计阶段费用:</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" autocomplete="off" class="el-input__inner" id="designBudget" name="designBudget" th:value="${project.designBudget}" placeholder="请输入设计预算费用"/>
				   <span class="yuan_after">元</span>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
				  
			<div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">费用分配：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" autocomplete="off" id="fee0" class="el-input__inner" th:value="${money1?.buildingMoney}" name="buildingMoney" style="width: 120px;" placeholder="建筑"/>
				   <input type="text" autocomplete="off" id="fee1" class="el-input__inner" th:value="${money1?.structureMoney}" name="structureMoney" style="width: 120px;" placeholder="结构"/>
				   <input type="text" autocomplete="off" id="fee2" class="el-input__inner" th:value="${money1?.waterMoney}" name="waterMoney" style="width: 120px;" placeholder="水"/>
				   <input type="text" autocomplete="off" id="fee4" class="el-input__inner" th:value="${money1?.warmMoney}" name="warmMoney" style="width: 120px;" placeholder="暖"/>
				   <input type="text" autocomplete="off" id="fee3" class="el-input__inner" th:value="${money1?.electricityMoney}" name="electricityMoney" style="width: 120px;" placeholder="电"/>
				   <span class="yuan_after">元</span>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>



				 <div class="NameAndEmail clearfix">
					 <div class="Name">
						 <div class="el-form-item is-required">
							 <label for="name" class="el-form-item__label" style="width: 125px;">施工图阶段费用:</label>
							 <div class="el-form-item__content" style="margin-left: 125px;">
								 <div class="changeWidth el-input">
									 <input type="text" autocomplete="off" class="el-input__inner" id="planBudget" name="planBudget" th:value="${project.planBudget}" placeholder="请输入施工预算费用"/>
								 	 <span class="yuan_after">元</span>
								 </div>
							 </div>
						 </div>
					 </div>
				 </div>


				 <div class="NameAndEmail clearfix">
					 <div class="Name">
						 <div class="el-form-item is-required">
							 <label for="name" class="el-form-item__label" style="width: 125px;">费用分配：</label>
							 <div class="el-form-item__content" style="margin-left: 125px;">
								 <div class="changeWidth el-input">
									 <input type="text" autocomplete="off" id="constructFee0" class="el-input__inner" th:value="${money2?.buildingMoney}" name="buildingMoney1" style="width: 120px;" placeholder="建筑"/>
									 <input type="text" autocomplete="off" id="constructFee1" class="el-input__inner" th:value="${money2?.structureMoney}" name="structureMoney1" style="width: 120px;" placeholder="结构"/>
									 <input type="text" autocomplete="off" id="constructFee2" class="el-input__inner" th:value="${money2?.waterMoney}" name="waterMoney1" style="width: 120px;" placeholder="水"/>
                                     <input type="text" autocomplete="off" id="constructFee4" class="el-input__inner" th:value="${money2?.warmMoney}" name="warmMoney1" style="width: 120px;" placeholder="暖"/>
									 <input type="text" autocomplete="off" id="constructFee3" class="el-input__inner" th:value="${money2?.electricityMoney}" name="electricityMoney1" style="width: 120px;" placeholder="电"/>
								     <span class="yuan_after">元</span>
								 </div>
							 </div>
						 </div>
					 </div>
				 </div>
				  
			<div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item is-required">
				 <label for="name" class="el-form-item__label" style="width: 125px;">项目简介：</label>
					<div class="el-form-item__content" style="margin-left: 125px;">
						<!--注：id值不可变为【editorValue】，用于ueditor获取内容填充到富文本编辑器中-->
						<input id="editorValue" class="form-label col-xs-16 col-sm-16" type="hidden" />
						<script id="editor"  th:text="${project.introduce}"
							name="introduce" type="text/plain" style="height:500px;width:800px">
						</script>
					</div>

				</div>
			   </div>
			  </div>

				 <div class="NameAndEmail clearfix">
					 <div class="Name">
						 <div class="el-form-item is-required">
							 <label for="name" class="el-form-item__label" style="width: 125px;">上传展示图片：</label>
							 <div class="el-form-item__content" style="margin-left: 125px;">
								 <div class="changeWidth el-input">
									 <input type="text" autocomplete="off" th:value="${project.coverImage}" id="imgPath" class="el-input__inner"/>
									 <a href="javascript:void();" class="btn btn-primary upload-btn" style="line-height: 32px;"><i class="Hui-iconfont"></i> 重新上传</a>
									 <input type="file" multiple="" name="image" id="image" class="input-file valid" style="height: 100%;">
								 </div>
							 </div>
						 </div>
					 </div>
				 </div>


			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item">
				 <label for="name" class="el-form-item__label" style="width: 125px;">备注：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
				   <input type="text" autocomplete="off" class="el-input__inner" name="remarks" th:value="${project.remarks}" placeholder="请输入备注"/>
				  </div>
				 </div>
				</div>
			   </div>
			  </div>
			  
			  <div class="NameAndEmail clearfix">
					<div class="Name">
						<div class="el-form-item">
							<label for="name" class="el-form-item__label" style="width: 125px;">已上传文件：</label>
								<div class="el-form-item__content" style="margin-left: 125px;">
									<div class="changeWidth el-input">
									<input type="text" style="display:none" name="files" id="noneFile"  autocomplete="off" class="el-input__inner" value="未上传任何文件"/>
										<div th:each="url : ${urlList}" th:attr="id='delDiv_'+${url.id}"  style="margin-top:10px;">
										<input type="text" name="files" autocomplete="off" class="el-input__inner" th:value="${url.filename}" />
										<button type="button" class="el-button el-button--danger el-button--mini"  th:onclick="'javascript:delPre('+${url.id}+');'" style="margin-left:30px;" data-v-d0b3a19c="">
										<span>删除</span></button>
									</div>
								<input type="hidden" name = "deleteIds" id="deleteIds"/>
								</div>
							</div>
						</div>
					</div>
				</div>


			  <div class="NameAndEmail clearfix">
			   <div class="Name">
				<div class="el-form-item">
				 <label for="name" class="el-form-item__label" style="width: 125px;">上传新文件：</label>
				 <div class="el-form-item__content" style="margin-left: 125px;">
				  <div class="changeWidth el-input">
	                <a href="javascript:void();" class="btn btn-primary upload-btn" style="line-height: 32px;"><i class="Hui-iconfont"></i> 添加</a>
	                <input type="file" multiple="" name="files" id="files" class="input-file valid" style="height: 33px;">
				  </div>
						<div class="changeWidth" id="div_parent"></div>
				 </div>
				</div>
			   </div>
			  </div>
				  
				  
				  
			  </div>
			  <div>
			   <button type="submit" id="submit" class="el-button el-button--primary el-button--mini"  style="margin-left:150px;" data-v-d0b3a19c="">
            		<span>修改</span></button>
             <button type="button" onclick="toLocation()" class="el-button el-button--cancle el-button--mini" style="margin-left:60px;" data-v-d0b3a19c="">
            		取消</button>
			  </div>
			 </div>
			 </form>
			</div>
		   
		</div>
 </body>
 <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/jquery.validate.js}" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/validate-methods.js}" src="lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/messages_zh.js}"  src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" th:src="@{/lib/My97DatePicker/4.8/WdatePicker.js}"  src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
 <script type="text/javascript" th:src="@{/lib/select/fSelect.js}" src="lib/select/fSelect.js"></script>
 <script type="text/javascript" th:src="@{/lib/layer/2.4/layer.js}" src="lib/layer/2.4/layer.js"></script>
 <script data-n-head="true" th:src="@{/js/common/layer.js}" src="js/common/layer.js"></script>
						<script type="text/javascript" th:src="@{/lib/jquery.validation/1.14.0/jquery.form.min.js}" src="lib/jquery.validation/1.14.0/jquery.form.min.js"></script>


<script type="text/javascript" charset="utf-8" th:src="@{/lib/ueditor/1.4.3/ueditor.config.js}" src="lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" th:src="@{/lib/ueditor/1.4.3/ueditor.all.min.js}" src="lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" th:src="@{/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js}" src="lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" th:src="@{/lib/ueditor/1.4.3/ueditor.js}" src="lib/ueditor/1.4.3/ueditor.js"> </script>

 <script>
 	
//  	/*用来检测种类费用是否达到总和*/
// 	 $("input[name='introduce']").change(function(){
// 		 var total = 0;
// 		 var num = $("#designBudget").val();
// 		 $("input[id^='fee']").each(function(){
// 			 total += Number($(this).val());
// 		 });
// 		 if(total > num){
// 			 layer.designMsg('各种类费用总和超出预算!',2);
// 		 }
// 		 if(total < num){
// 			 layer.designMsg('各种类费用总和不足预算!',2);
// 		 }
// 	 });
	
 	/*种类回显选中*/
	 function fun(){
	     var val = document.getElementById("designerType").value.split(",");
	     var boxes = document.getElementsByName("designerTypes");
	     for(i=0;i<boxes.length;i++){
	         for(j=0;j<val.length;j++){
	             if(boxes[i].value == val[j]){
	                 boxes[i].checked = true;
	             }
	         }
	     }
	 }
 	
	 /*用来控制选取那几个种类后展示那几个种类费用文本框*/
	 function select(){
		    var boxes = document.getElementsByName("designerTypes");
		    for(i=0;i<boxes.length;i++){
		         if(!boxes[i].checked){
		        	 $("#fee"+i).css("display","none");
					 $("#constructFee"+i).css("display","none");
		         }
		         if(boxes[i].checked){
		        	 $("#fee"+i).css("display","inline");
					 $("#constructFee"+i).css("display","inline");
		         }
		    }
	 }
	 $("input[type='checkbox']").change(function(){
			 select();
	});
	 /*删除已上传文件*/
	 function del(id){
		 $.ajax({
             type: 'post',
             url: "/center/myProject/deleteFile" ,
             data:{"id":id},
             success: function(data){
                 if(data == "success"){
                     layer.designMsg('删除成功!',1,function(){
                         var index = parent.layer.getFrameIndex(window.name);
                         parent.location.reload();
                         parent.layer.close(index);
                     });
                 }else{
                     layer.msg('删除失败!',{icon:1,time:1000});
                 }
             },
             error: function(XmlHttpRequest, textStatus, errorThrown){
                 layer.msg('删除失败!请检查网络连接！',{icon:1,time:1000});
             }
         });
	 }
 	
	 function  delPre(id) {
		 var deleteIds = $('#deleteIds').val();
		 if (deleteIds == ""){
			 $('#deleteIds').val(id);
		 }else{
			 $('#deleteIds').val(deleteIds+","+id);
		 }
		 $('#delDiv_'+id).remove();
		 showNoneFile();
	 }
	 showNoneFile();
	 function showNoneFile() {
		 if($('div[id^=delDiv_]').length == 0){
			 $('#noneFile').show();
		 }else{
			 $('#noneFile').hide();
		 }
	 }
 	function toLocation(){
 		var index = parent.layer.getFrameIndex(window.name);
		parent.layer.close(index);
    }
 	
 	var file = $('#files'),
	 aim1 = $('#path');
 	
	file.on('change', function( e ){
	var i;
	//e.currentTarget.files 是一个数组，如果支持多个文件，则需要遍历
	for (i = 0;i < e.currentTarget.files.length; i++){
		 var name = e.currentTarget.files[i].name;
	
		 $("#div_parent").html($("#div_parent").html()+'<div class="div_file" style="margin-top:10px;"><input type="text" class="el-input__inner" value="'+name+'" name="files"><button onclick="$(this).parent().remove()" type="button" class="el-button el-button--danger el-button--mini"  style="margin-left:30px;"><span>删除</span></button></div>');
	
	
		 // if($.trim(aim1.val()) == ''){
		 // 	aim1.val( aim1.val()+name );
		 // }
		 // else if($.trim(aim1.val()) != ''){
		 // 	aim1.val( aim1.val()+","+name );
		 // }
	}
	});
	
	var image = $('#image'),
		aim1 = $('#imgPath');
	image.on('change', function( e ){
	var i;
	//e.currentTarget.files 是一个数组，如果支持多个文件，则需要遍历
	if(e.currentTarget.files.length > 1){
		layer.msg('只能上传一个图片!',{icon:1,time:1000});
		image.val('');
	}else{
		for (i = 0;i < e.currentTarget.files.length; i++){
			var name = e.currentTarget.files[i].name;
			if($.trim(aim1.val()) == ''){
				aim1.val( aim1.val()+name );
			}
			else if($.trim(aim1.val()) != ''){
				aim1.val( aim1.val()+","+name );
			}
		}
	}
	});

 
//  $(function () {
//      $("#submit").click(function () {
//     	 var form = new FormData(document.getElementById("form")); 
//          $.ajax({
//              url: "/center/myProject/updateProject",
//              type: "POST",
//              data: formData,
//              /**
//              *必须false才会自动加上正确的Content-Type
//              */
//              contentType: false,
//              /**
//              * 必须false才会避开jQuery对 formdata 的默认处理
//              * XMLHttpRequest会对 formdata 进行正确的处理
//              */
//              processData: false,
//              success: function (data) {
//                  if (data == "success") {
//                      alert("上传成功！");
//                  }
//                  if (data == "fail") {
//                      alert("修改失败");
//                  }
//              },
//              error: function () {
//                  alert("上传失败！");
//              }
//          });
//      });
//  });
 
 
 
 $(function() {
	    $('.demo').fSelect();
	    fun();
	    select();
	});
 
 var result;
 //选择省份事件
$("#provinceId").change(function() {
	//先清空城市和区
	$("#cityId").empty();
	$("#areaId").empty();
	$('#cityId').append("<option value=''>待选择</option>");
	$('#areaId').append("<option value=''>待选择</option>");
	if($("#provinceId").val()==""){
		//啥都不做
	}else{
		chooseDic("province",$("#provinceId").val());
		var flag = false;
		if(result.length != 0){
			$('#cityDiv').css("display","inline");
			$('#areaDiv').css("display","inline");
			for (i in result){
				$('#cityId').append("<option value='"+result[i].cityId+"'>"+result[i].name+"</option>");
			}
		}else{
			$('#cityDiv').css("display","none");
			$('#areaDiv').css("display","none");
		}
	}
});
//选择城市事件
$("#cityId").change(function() {
	//先清空规格
	$("#areaId").empty();
	$('#areaId').append("<option value=''>待选择</option>");
	if($("#cityId").val()==""){
		//啥都不做
	}else{
		chooseDic("city",$("#cityId").val());
		if(result.length != 0){
			$('#areaDiv').css("display","inline");
			for (i in result){
				$('#areaId').append("<option value='"+result[i].areaId+"'>"+result[i].name+"</option>");
			}
		}else{
			$('#areaDiv').css("display","none");
		}
	}
});
//选择下拉菜单时和后台要字典的交互方法
function chooseDic(who,code){
	var toServer={
		who : who,
		code : code,
	}
	//此处请求后台程序，下方是成功后的前台处理……
	$.ajax({
		type: 'POST',
		url: "/admin/projectmanager/getareadic",
		dataType: 'json',
		data:toServer,
		async:false,
		success: function(data){
			//返回服务器返回的字典对象
			result = data;
			
		},
		error:function(data) {
			console.log("错误!");
		},
	});
}
 
//加载时请求回显省市区
$(function(){
	$('#provinceId').val($('#pId').val());
	$('#allowView').val($('#allowViewValue').val());
	chooseDic("province",$("#provinceId").val());
	if(result.length != 0){
		for (i in result){
			$('#cityId').append("<option value='"+result[i].cityId+"'>"+result[i].name+"</option>");
		}
		$('#cityId').val($('#cId').val());
	}else{
		$('#cityDiv').css("display","none");
		$('#areaDiv').css("display","none");
	}
	chooseDic("city",$("#cityId").val());
	if(result.length != 0){
		for (i in result){
			$('#areaId').append("<option value='"+result[i].areaId+"'>"+result[i].name+"</option>");
		}
		$('#areaId').val($('#areaRecord').val());
		$('#areaId').val($('#aId').val());
	}else{
		$('#areaDiv').css("display","none");
	}
}); 
// (function ($) {
// 	$.extend($.validator.messages, {
// 		required: "",
// 	});
// 	}(jQuery));
 	
$("#form").validate({
	rules:{
		name:{
			required:true,
			minlength:4,
			maxlength:16
		},
		typeCode:{
			required:true,
		},
		provinceId:{
			required:true,
		},
		cityId:{
			required:true,
		},
		areaId:{
			required:true,
		},
		modelCode:{
			required:true,
		},
		startupDate:{
			required:true,
		},
		deadline:{
			required:true,
		},
        requirements:{
            required:true,
        },
		registrationDeadline:{
			required:true,
		},
		constructionBudget:{
			required:true,
			allBudget:true,
            number:true
		},
		designerTypes:{
			required:true,
		},
		allowView:{
			required:true,
		},
		designBudget:{
			required:true,
            number:true
		},
		planBudget:{
			required:true,
            number:true
		},
		introduce:{
			required:true,
		},
		imgPath:{
			required:true,
		},
		buildingMoney:{
			required:true,
			feeEqualStage1:true,
            number:true
		},
		structureMoney:{
			required:true,
			feeEqualStage1:true,
            number:true
		},
		waterMoney:{
			required:true,
			feeEqualStage1:true,
            number:true
		},
		warmMoney:{
			required:true,
			feeEqualStage1:true,
            number:true
		},
		electricityMoney:{
			required:true,
			feeEqualStage1:true,
            number:true
		},
		buildingMoney1:{
			required:true,
			feeEqualStage2:true,
            number:true
		},
		structureMoney1:{
			required:true,
			feeEqualStage2:true,
            number:true
		},
		waterMoney1:{
			required:true,
			feeEqualStage2:true,
            number:true
		},
		warmMoney1:{
			required:true,
			feeEqualStage2:true,
            number:true
		},
		electricityMoney1:{
			required:true,
			feeEqualStage2:true,
            number:true
		},
	},
	onkeyup:false,
	success:"valid",
	submitHandler:function(form){
		$(form).ajaxSubmit({
			type: 'post',
			url: "/admin/projectmanager/updateProject",
			beforeSend:function()
			{
				$('#submit').attr('disabled',true);
			},
			success: function(data){
				if(data == 1){
					//禁止重复提交
					layer.msg('修改成功',{icon:1,time:1000},function(){
						var index = parent.layer.getFrameIndex(window.name);
						parent.layer.close(index);
						window.location.reload;
					});
				}else if(data == 2){
					layer.msg("修改失败！");
					return false;
				}else{
					layer.msg('修改失败!',{icon:5,time:1000});
				}
			},
			error: function(XmlHttpRequest, textStatus, errorThrown){
				layer.msg('error!',{icon:5,time:1000});
			}
		});

	}
});

 </script>
</html>
